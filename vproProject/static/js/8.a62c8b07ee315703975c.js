webpackJsonp([8],{"5PlU":function(e,t,n){var o=n("RY/4"),i=n("dSzd")("iterator"),s=n("/bQp");e.exports=n("FeBl").isIterable=function(e){var t=Object(e);return void 0!==t[i]||"@@iterator"in t||s.hasOwnProperty(o(t))}},X8O2:function(e,t,n){var o=n("iI9/");"string"==typeof o&&(o=[[e.i,o,""]]),o.locals&&(e.exports=o.locals);n("rjj0")("1d4325de",o,!0)},Xd32:function(e,t,n){n("+tPU"),n("zQR9"),e.exports=n("5PlU")},d7EF:function(e,t,n){"use strict";t.__esModule=!0;var o=s(n("us/S")),i=s(n("BO1k"));function s(e){return e&&e.__esModule?e:{default:e}}t.default=function(){return function(e,t){if(Array.isArray(e))return e;if((0,o.default)(Object(e)))return function(e,t){var n=[],o=!0,s=!1,a=void 0;try{for(var r,c=(0,i.default)(e);!(o=(r=c.next()).done)&&(n.push(r.value),!t||n.length!==t);o=!0);}catch(e){s=!0,a=e}finally{try{!o&&c.return&&c.return()}finally{if(s)throw a}}return n}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}()},fTvm:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=n("d7EF"),i=n.n(o),s=n("//Fk"),a=n.n(s),r=n("fZjL"),c=n.n(r),m={mounted:function(){if(c()(this.$route.query).length>0){var e=[this.$route.query.course_id,this.$route.query.lesson_id];this.course_id=e[0],this.lesson_id=e[1],this.combineComments()}},data:function(){return{course_id:"",lesson_id:"",reply:"",pop_is_showed:!0,comments:[],active_comments:[],pages:{currentPage:1,pageSize:10,total:-1},loading:!1}},components:{commentsPagination:n("puCb").default},methods:{combineComments:function(){var e=this;this.getComment().then(function(t){t.comments_length>0&&e.getCommentSupportRate(t).then(function(t){e.addSupportRateToComments(t.data)})})},handlePageChange:function(e){this.pages.currentPage=e},agree:function(e){this.$store.dispatch("agree",{comment_id:e}).then(function(e){})},reject:function(e){this.$store.dispatch("reject",{comment_id:e}).then(function(e){})},getCommentSupportRate:function(e){return this.$store.dispatch("getCommentSupportRate",{comments_ids:e})},getComment:function(){var e=this;return this.loading=!0,new a.a(function(t,n){e.$store.dispatch("getComment",{lesson_id:e.lesson_id,p:e.pages.currentPage}).then(function(n){e.loading=!1,e.comments=n.data.comments,e.pages.total=n.data.comments_length,t(n.data.comments_ids)}).catch(function(e){n(e)})})},addSupportRateToComments:function(e){this.comments=this.comments.map(function(t,n){t.hasOwnProperty("parent")&&t.parent.map(function(t){for(var n in e)if(t.vpro_comment_id===n){var o=i()(e[n],2);return t.agree=o[0],t.oppose=o[1],t}});var o=i()(e[t.vpro_comment_id],2);return t.agree=o[0],t.oppose=o[1],t})},showOmitComments:function(e){this.active_comments.indexOf(e.vpro_comment_id)<0&&this.active_comments.push(e.vpro_comment_id),console.log(-1===!this.active_comments.indexOf(e.vpro_comment_id)&&e.parent.length>2)},replyComment:function(e){var t=this;this.$store.dispatch("setComment",{comment_course_id:e.vpro_comment_course_id,comment_lesson_id:e.vpro_comment_lesson_id,comment_reply_id:e.vpro_comment_id,comment_reply_main_id:"0"===e.vpro_comment_reply_main_id?e.vpro_comment_id:e.vpro_comment_reply_main_id,comment_content:this.reply}).then(function(e){t.$message({message:"回复成功",type:"success"}),t.reply=""}).catch(function(e){console.log(e),t.$message.error("评论提交失败！")})},clickAgree:function(e){var t=this;this.$store.dispatch("getRateForbidden",{commentId:e.vpro_comment_id}).then(function(n){n>=0?t.$message.error("您已经点过这条评论了"):t.changeSupportRate(e,"agree")})},clickOppose:function(e){var t=this;this.$store.dispatch("getRateForbidden",{commentId:e.vpro_comment_id}).then(function(n){n>=0?t.$message.error("您已经点过这条评论了"):t.changeSupportRate(e,"oppose")})},changeSupportRate:function(e,t){var n=this;for(var o in this.comments){if(this.comments[o].hasOwnProperty("parent")){var i=this.comments[o].parent;for(var s in i)i[s].vpro_comment_id===e.vpro_comment_id&&(i[s][t]=parseInt(i[s][t])+1,i.splice(s,1,i[s]))}this.comments[o].vpro_comment_id===e.vpro_comment_id&&(this.comments[o][t]=parseInt(this.comments[o][t])+1,this.comments.splice(o,1,this.comments[o]))}this.$store.dispatch("setCommentSupportRate",{type:t,comment_id:e.vpro_comment_id,lesson_id:e.vpro_comment_lesson_id}).then(function(t){parseInt(t)>0&&n.$store.dispatch("setRateForbidden",{commentId:e.vpro_comment_id})})}},watch:{comments:{deep:!0,handler:function(e,t){}},"pages.currentPage":function(e,t){t!==e&&(console.log(e),this.combineComments(),window.scrollTo(0,1250))}}},l={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("el-card",{staticClass:"play-comment"},[n("div",{staticClass:"comment-title"},[n("span",[e._v("评论")]),e._v(" "),n("hr"),e._v(" "),n("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"comment-detail"},[n("div",{staticClass:"comment-single"},[e._l(e.comments,function(t,o){return e.comments.length?n("el-row",{key:o,staticClass:"comment",attrs:{gutter:20}},[n("el-col",{attrs:{span:4}},[n("div",{staticClass:"comment-avatar"},[n("img",{attrs:{src:"http://ozg76yopg.bkt.clouddn.com/face.jpg?imageView2/1/w/50/h/50/format/jpg/interlace/1/q/75|imageslim",alt:""}})])]),e._v(" "),n("el-col",{attrs:{span:20}},[n("div",{staticClass:"comment-summary"},[n("span",{staticClass:"user-name"},[e._v(e._s(t.auth_appid))]),e._v(" "),n("span",{staticClass:"time"},[e._v("时间")])]),e._v("-\n                        "),n("div",{staticClass:"clearfix"}),e._v(" "),void 0!==t.parent?n("div",{staticClass:"replys"},[n("div",{directives:[{name:"show",rawName:"v-show",value:-1===e.active_comments.indexOf(t.vpro_comment_id)&&t.parent.length>2,expression:"active_comments.indexOf(item.vpro_comment_id) === -1 && item.parent.length > 2"}],staticClass:"comment-omission"},[n("a",{on:{click:function(n){e.showOmitComments(t)}}},[n("i",{staticClass:"el-icon-more"}),e._v(" 显示更多 "),n("i",{staticClass:"el-icon-more"})])]),e._v(" "),e._l(t.parent,function(o,i){return n("el-row",{directives:[{name:"show",rawName:"v-show",value:i===t.parent.length-1||e.active_comments.indexOf(t.vpro_comment_id)>=0,expression:"k === item.parent.length - 1 || active_comments.indexOf(item.vpro_comment_id) >= 0"}],key:i,class:{comment:!0,replyLine:1!==t.parent.length&&t.parent.length-1!==i},attrs:{gutter:20}},[n("el-col",{attrs:{span:4}},[n("div",{staticClass:"comment-avatar"},[n("img",{attrs:{src:"http://ozg76yopg.bkt.clouddn.com/face.jpg?imageView2/1/w/50/h/50/format/jpg/interlace/1/q/75|imageslim",alt:""}})])]),e._v(" "),n("el-col",{attrs:{span:20}},[n("div",{staticClass:"comment-summary"},[n("span",{staticClass:"user-name"},[e._v(e._s(o.auth_appid))]),e._v(" "),n("span",{staticClass:"time"},[e._v("时间")])]),e._v(" "),n("div",{staticClass:"clearfix"}),e._v(" "),n("div",{staticClass:"comment-content"},[n("span",[e._v(e._s(o.vpro_comment_content))])]),e._v(" "),n("div",{staticClass:"comment-support",attrs:{course_id:o.vpro_comment_course_id,lesson_id:o.vpro_comment_lesson_id,reply_id:o.vpro_comment_reply_id,reply_main_id:o.vpro_comment_reply_main_id,comment_id:o.vpro_comment_id}},[n("a",{on:{click:function(t){e.clickAgree(o)}}},[n("i",{staticClass:"el-icon-check"}),e._v("("+e._s(o.agree)+")")]),e._v(" "),n("a",{on:{click:function(t){e.clickOppose(o)}}},[n("i",{staticClass:"el-icon-close"}),e._v("("+e._s(o.oppose)+")")]),e._v(" "),n("el-popover",{attrs:{placement:"left-start",width:"600",trigger:"click"}},[n("div",[n("el-input",{attrs:{type:"textarea",rows:2,placeholder:"欢迎对课程进行点评，具备参考价值的评论对其他人更有帮助"},model:{value:e.reply,callback:function(t){e.reply=t},expression:"reply"}}),e._v(" "),n("div",{staticStyle:{"text-align":"right",margin:"5px 0 0 0"}},[n("el-button",{attrs:{size:"mini",type:"danger"},on:{click:function(t){e.replyComment(o)}}},[e._v("回复评论")])],1)],1),e._v(" "),n("a",{attrs:{slot:"reference"},slot:"reference"},[n("i",{staticClass:"el-icon-back"})])])],1),e._v(" "),1!==t.parent.length&&t.parent.length-1!==i?n("hr"):e._e()])],1)})],2):e._e(),e._v(" "),n("div",{staticClass:"comment-content"},[n("span",[e._v(e._s(t.vpro_comment_content))])]),e._v(" "),n("div",{staticClass:"comment-support",attrs:{course_id:t.vpro_comment_course_id,lesson_id:t.vpro_comment_lesson_id,reply_id:t.vpro_comment_reply_id,reply_main_id:t.vpro_comment_reply_main_id,comment_id:t.vpro_comment_id}},[n("a",{on:{click:function(n){e.clickAgree(t)}}},[n("i",{staticClass:"el-icon-check"}),e._v("("+e._s(t.agree)+")")]),e._v(" "),n("a",{on:{click:function(n){e.clickOppose(t)}}},[n("i",{staticClass:"el-icon-close"}),e._v("("+e._s(t.oppose)+")")]),e._v(" "),n("el-popover",{attrs:{placement:"left-start",width:"600",trigger:"click"}},[n("div",[n("el-input",{attrs:{type:"textarea",rows:2,placeholder:"欢迎对课程进行点评，具备参考价值的评论对其他人更有帮助"},model:{value:e.reply,callback:function(t){e.reply=t},expression:"reply"}}),e._v(" "),n("div",{staticStyle:{"text-align":"right",margin:"5px 0 0 0"}},[n("el-button",{attrs:{size:"mini",type:"danger"},on:{click:function(n){e.replyComment(t)}}},[e._v("回复评论")])],1)],1),e._v(" "),n("a",{attrs:{slot:"reference"},slot:"reference"},[n("i",{staticClass:"el-icon-back"})])])],1)])],1):e._e()}),e._v(" "),e.comments.length?e._e():n("el-row",[n("el-col",{attrs:{span:24}},[n("div",{staticStyle:{color:"#cccccc","text-align":"center",padding:"20px 0"}},[n("span",[e._v("还未有人评论~")])])])],1),e._v(" "),n("hr")],2),e._v(" "),e.pages.total>this.pages.pageSize?n("comments-pagination",{staticClass:"comment-pagination",attrs:{pageSize:this.pages.pageSize,total:e.pages.total},on:{pageChange:e.handlePageChange}}):e._e()],1)])])},staticRenderFns:[]};var p=n("VU/8")(m,l,!1,function(e){n("X8O2")},null,null);t.default=p.exports},"iI9/":function(e,t,n){(e.exports=n("FZ+f")(!1)).push([e.i,"\n.play-container{\n    margin: 1%;\n}\n.clearfix{\n    clear: both\n}\n.comment-single{\n    margin: 10px;\n}\n.comment{\n    margin: 10px 0;\n    padding: 10px 0;\n}\n.comment-title{\n}\n.comment-single .comment-avatar{\n    text-align: center;\n}\n.comment-single .comment-avatar img{\n    border-radius: 25px;\n}\n.comment-summary{\n    text-align: center;\n}\n.comment-single .user-name{\n    display: block;\n    float:left;\n    margin: 0 0 10px 0;\n}\n.comment-single .time{\n    display: block;\n    float: right;\n    margin: 0 0 10px 0;\n}\n.comment-single .comment-support{\n    text-align: right;\n    margin: 5px 0 0 0;\n}\n.comment-single .comment-support a{\n    color: #ccc;\n    font-size: 14px;\n    margin: 0 5px;\n    text-decoration: none;\n    cursor: pointer\n}\n.comment-single .comment-support a:hover{\n    color: #FF4949;\n}\n.comment-single .replys{\n    background-color: #F8F8F8;\n    border: 1px solid #ddd;\n    padding: 0 10px 0 0;\n}\n.comment-single .replys .comment-omission {\n    text-align: center;\n    color: #999;\n    font-size: 12px;\n    padding: 10px 0;\n    border: none;\n    border-top: 1px solid #eeeeee;\n    border-bottom: 1px solid #eeeeee;\n}\n.comment-omission a{\n    cursor: pointer;\n    text-decoration: none;\n}\n.comment-omission a:hover{\n    cursor: pointer;\n    color: #FF4949;\n}\n/*.comment-single .replyLine{*/\n/*border-bottom: 1px solid #ddd;*/\n/*}*/\n.comment-single .comment-content{\n    color: #666;\n    font-size: 16px;\n}\n.play-comment{\n    overflow: auto;\n    height: 1%;\n}\n.play-comment hr{\n    border: none;\n    margin: 10px 0;\n    border-bottom: 1px #eee solid;\n}\n.el-card{\n    max-height: none !important;\n}\n.comment-pagination{\n    text-align: center\n}\n",""])},"us/S":function(e,t,n){e.exports={default:n("Xd32"),__esModule:!0}}});